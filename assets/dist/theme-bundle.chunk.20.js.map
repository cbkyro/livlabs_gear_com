{"version":3,"sources":["webpack:///./assets/js/theme/search.js"],"names":["Search","formatCategoryTreeForJSTree","node","nodeData","text","data","id","metadata","state","selected","opened","children","forEach","childNode","push","showProducts","url","urlUtils","replaceParams","window","location","href","section","$productListingContainer","removeClass","$facetedSearchContainer","$contentResultsContainer","addClass","$","goToUrl","showContent","onReady","$searchForm","$categoryTreeContainer","find","Url","parse","treeData","length","initFacetedSearch","onSortBySubmit","bind","hooks","on","collapsibleFactory","event","preventDefault","query","validator","initValidation","bindValidation","context","categoryTree","categoryTreeData","createCategoryTree","selectedCategoryIds","jstree","get_selected","check","remove","categoryId","input","type","name","value","append","loadTreeNodes","cb","ajax","selectedCategoryId","prefix","done","formattedResults","dataNode","$container","treeOptions","core","themes","icons","checkbox","three_state","plugins","$searchHeading","$searchCount","productsPerPage","searchProductsPerPage","requestOptions","template","productListing","sidebar","heading","productCount","config","product_results","limit","showMore","facetedSearch","content","html","animate","scrollTop","$form","nod","submit","$element","add","selector","validate","errorMessage","performCheck","areAll"],"mappings":"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","file":"theme-bundle.chunk.20.js","sourcesContent":["import { hooks } from '@bigcommerce/stencil-utils';\r\nimport CatalogPage from './catalog';\r\nimport $ from 'jquery';\r\nimport FacetedSearch from './common/faceted-search';\r\nimport urlUtils from './common/url-utils';\r\nimport Url from 'url';\r\nimport collapsibleFactory from './common/collapsible';\r\nimport 'jstree';\r\nimport nod from './common/nod';\r\n\r\nexport default class Search extends CatalogPage {\r\n    formatCategoryTreeForJSTree(node) {\r\n        const nodeData = {\r\n            text: node.data,\r\n            id: node.metadata.id,\r\n            state: {\r\n                selected: node.selected,\r\n            },\r\n        };\r\n\r\n        if (node.state) {\r\n            nodeData.state.opened = node.state === 'open';\r\n            nodeData.children = true;\r\n        }\r\n\r\n        if (node.children) {\r\n            nodeData.children = [];\r\n            node.children.forEach((childNode) => {\r\n                nodeData.children.push(this.formatCategoryTreeForJSTree(childNode));\r\n            });\r\n        }\r\n\r\n        return nodeData;\r\n    }\r\n\r\n    showProducts() {\r\n        const url = urlUtils.replaceParams(window.location.href, {\r\n            section: 'product',\r\n        });\r\n\r\n        this.$productListingContainer.removeClass('u-hiddenVisually');\r\n        this.$facetedSearchContainer.removeClass('u-hiddenVisually');\r\n        this.$contentResultsContainer.addClass('u-hiddenVisually');\r\n\r\n        $('[data-content-results-toggle]').removeClass('navBar-action-color--active');\r\n        $('[data-content-results-toggle]').addClass('navBar-action');\r\n\r\n        $('[data-product-results-toggle]').removeClass('navBar-action');\r\n        $('[data-product-results-toggle]').addClass('navBar-action-color--active');\r\n\r\n        urlUtils.goToUrl(url);\r\n    }\r\n\r\n    showContent() {\r\n        const url = urlUtils.replaceParams(window.location.href, {\r\n            section: 'content',\r\n        });\r\n\r\n        this.$contentResultsContainer.removeClass('u-hiddenVisually');\r\n        this.$productListingContainer.addClass('u-hiddenVisually');\r\n        this.$facetedSearchContainer.addClass('u-hiddenVisually');\r\n\r\n        $('[data-product-results-toggle]').removeClass('navBar-action-color--active');\r\n        $('[data-product-results-toggle]').addClass('navBar-action');\r\n\r\n        $('[data-content-results-toggle]').removeClass('navBar-action');\r\n        $('[data-content-results-toggle]').addClass('navBar-action-color--active');\r\n\r\n        urlUtils.goToUrl(url);\r\n    }\r\n\r\n    onReady() {\r\n        const $searchForm = $('[data-advanced-search-form]');\r\n        const $categoryTreeContainer = $searchForm.find('[data-search-category-tree]');\r\n        const url = Url.parse(window.location.href, true);\r\n        const treeData = [];\r\n        this.$productListingContainer = $('#product-listing-container');\r\n        this.$facetedSearchContainer = $('#faceted-search-container');\r\n        this.$contentResultsContainer = $('#search-results-content');\r\n\r\n        // Init faceted search\r\n        if ($('#facetedSearch').length > 0) {\r\n            this.initFacetedSearch();\r\n        } else {\r\n            this.onSortBySubmit = this.onSortBySubmit.bind(this);\r\n            hooks.on('sortBy-submitted', this.onSortBySubmit);\r\n        }\r\n\r\n        // Init collapsibles\r\n        collapsibleFactory();\r\n\r\n        $('[data-product-results-toggle]').on('click', event => {\r\n            event.preventDefault();\r\n            this.showProducts();\r\n        });\r\n\r\n        $('[data-content-results-toggle]').on('click', event => {\r\n            event.preventDefault();\r\n            this.showContent();\r\n        });\r\n\r\n        if (this.$productListingContainer.find('li.product').length === 0 || url.query.section === 'content') {\r\n            this.showContent();\r\n        } else {\r\n            this.showProducts();\r\n        }\r\n\r\n        const validator = this.initValidation($searchForm)\r\n            .bindValidation($searchForm.find('#search_query_adv'));\r\n\r\n        this.context.categoryTree.forEach((node) => {\r\n            treeData.push(this.formatCategoryTreeForJSTree(node));\r\n        });\r\n\r\n        this.categoryTreeData = treeData;\r\n        this.createCategoryTree($categoryTreeContainer);\r\n\r\n        $searchForm.on('submit', event => {\r\n            const selectedCategoryIds = $categoryTreeContainer.jstree().get_selected();\r\n\r\n            if (!validator.check()) {\r\n                return event.preventDefault();\r\n            }\r\n\r\n            $searchForm.find('input[name=\"category\\[\\]\"]').remove();\r\n\r\n            for (const categoryId of selectedCategoryIds) {\r\n                const input = $('<input>', {\r\n                    type: 'hidden',\r\n                    name: 'category[]',\r\n                    value: categoryId,\r\n                });\r\n\r\n                $searchForm.append(input);\r\n            }\r\n        });\r\n    }\r\n\r\n    loadTreeNodes(node, cb) {\r\n        $.ajax({\r\n            url: '/remote/v1/category-tree',\r\n            data: {\r\n                selectedCategoryId: node.id,\r\n                prefix: 'category',\r\n            },\r\n        }).done(data => {\r\n            const formattedResults = [];\r\n\r\n            data.forEach((dataNode) => {\r\n                formattedResults.push(this.formatCategoryTreeForJSTree(dataNode));\r\n            });\r\n\r\n            cb(formattedResults);\r\n        });\r\n    }\r\n\r\n    createCategoryTree($container) {\r\n        const treeOptions = {\r\n            core: {\r\n                data: (node, cb) => {\r\n                    // Root node\r\n                    if (node.id === '#') {\r\n                        cb(this.categoryTreeData);\r\n                    } else {\r\n                        // Lazy loaded children\r\n                        this.loadTreeNodes(node, cb);\r\n                    }\r\n                },\r\n                themes: {\r\n                    icons: true,\r\n                },\r\n            },\r\n            checkbox: {\r\n                three_state: false,\r\n            },\r\n            plugins: [\r\n                'checkbox',\r\n            ],\r\n        };\r\n\r\n        $container.jstree(treeOptions);\r\n    }\r\n\r\n    initFacetedSearch() {\r\n        const $productListingContainer = $('#product-listing-container');\r\n        const $facetedSearchContainer = $('#faceted-search-container');\r\n        const $searchHeading = $('#search-results-heading');\r\n        const $searchCount = $('#search-results-product-count');\r\n        const productsPerPage = this.context.searchProductsPerPage;\r\n        const requestOptions = {\r\n            template: {\r\n                productListing: 'search/product-listing',\r\n                sidebar: 'search/sidebar',\r\n                heading: 'search/heading',\r\n                productCount: 'search/product-count',\r\n            },\r\n            config: {\r\n                product_results: {\r\n                    limit: productsPerPage,\r\n                },\r\n            },\r\n            showMore: 'search/show-more',\r\n        };\r\n\r\n        this.facetedSearch = new FacetedSearch(requestOptions, (content) => {\r\n            $productListingContainer.html(content.productListing);\r\n            $facetedSearchContainer.html(content.sidebar);\r\n            $searchHeading.html(content.heading);\r\n            $searchCount.html(content.productCount);\r\n\r\n            $('html, body').animate({\r\n                scrollTop: 0,\r\n            }, 100);\r\n        });\r\n    }\r\n\r\n    initValidation($form) {\r\n        this.$form = $form;\r\n        this.validator = nod({\r\n            submit: $form,\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    bindValidation($element) {\r\n        if (this.validator) {\r\n            this.validator.add({\r\n                selector: $element,\r\n                validate: 'presence',\r\n                errorMessage: $element.data('errorMessage'),\r\n            });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    check() {\r\n        if (this.validator) {\r\n            this.validator.performCheck();\r\n            return this.validator.areAll('valid');\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n"],"sourceRoot":""}